---
// AI Analysis Card Component
const { analysis = {} } = Astro.props;

const strengths = analysis.strengths || [];
const weaknesses = analysis.weaknesses || [];
const opportunities = analysis.opportunities || [];
const threats = analysis.threats || [];
const summary = analysis.summary || '';

const hasError = strengths.length === 1 && strengths[0].includes('API error');

// Helper function to clean up markdown bullet points and filter empty items
function cleanMarkdown(text) {
  if (!text) return '';
  
  // Remove leading asterisks, dots, or dashes that might be part of markdown
  return text.replace(/^\s*[\*\-\.]\s*/, '').trim();
}

// Filter out empty items and clean markdown
function processItems(items) {
  return items
    .map(item => cleanMarkdown(item))
    .filter(item => item && item.length > 1); // Filter out empty or single-character items
}

// Process all sections
const cleanStrengths = processItems(strengths);
const cleanWeaknesses = processItems(weaknesses);
const cleanOpportunities = processItems(opportunities);
const cleanThreats = processItems(threats);
---

<div class="bg-white p-6 rounded-xl shadow-md">
  <h2 class="text-xl font-semibold mb-4">AI Analysis</h2>
  
  {!hasError ? (
    <div class="space-y-4">
      <!-- Strengths -->
      <div>
        <h3 class="text-green-600 font-medium mb-2">Strengths</h3>
        <ul class="list-disc pl-5 space-y-1">
          {cleanStrengths.map(strength => {
            // Split by colon to handle "Title: Description" format
            const parts = strength.split(/:\s*/);
            return (
              <li class="text-sm">
                {parts.length > 1 ? (
                  <>
                    <span class="font-semibold">{parts[0]}:</span> {parts.slice(1).join(': ')}
                  </>
                ) : (
                  strength
                )}
              </li>
            );
          })}
        </ul>
      </div>
      
      <!-- Weaknesses -->
      <div>
        <h3 class="text-red-600 font-medium mb-2">Weaknesses</h3>
        <ul class="list-disc pl-5 space-y-1">
          {cleanWeaknesses.map(weakness => {
            const parts = weakness.split(/:\s*/);
            return (
              <li class="text-sm">
                {parts.length > 1 ? (
                  <>
                    <span class="font-semibold">{parts[0]}:</span> {parts.slice(1).join(': ')}
                  </>
                ) : (
                  weakness
                )}
              </li>
            );
          })}
        </ul>
      </div>
      
      <!-- Opportunities -->
      <div>
        <h3 class="text-blue-600 font-medium mb-2">Opportunities</h3>
        <ul class="list-disc pl-5 space-y-1">
          {cleanOpportunities.map(opportunity => {
            const parts = opportunity.split(/:\s*/);
            return (
              <li class="text-sm">
                {parts.length > 1 ? (
                  <>
                    <span class="font-semibold">{parts[0]}:</span> {parts.slice(1).join(': ')}
                  </>
                ) : (
                  opportunity
                )}
              </li>
            );
          })}
        </ul>
      </div>
      
      <!-- Threats -->
      <div>
        <h3 class="text-orange-600 font-medium mb-2">Threats</h3>
        <ul class="list-disc pl-5 space-y-1">
          {cleanThreats.map(threat => {
            const parts = threat.split(/:\s*/);
            return (
              <li class="text-sm">
                {parts.length > 1 ? (
                  <>
                    <span class="font-semibold">{parts[0]}:</span> {parts.slice(1).join(': ')}
                  </>
                ) : (
                  threat
                )}
              </li>
            );
          })}
        </ul>
      </div>
    </div>
  ) : (
    <div class="bg-red-50 p-4 rounded-lg">
      <h3 class="text-red-800 font-medium mb-2">Analysis Unavailable</h3>
      <p class="text-sm text-red-700">We encountered an error analyzing this brand. Please try again later.</p>
    </div>
  )}
</div> 